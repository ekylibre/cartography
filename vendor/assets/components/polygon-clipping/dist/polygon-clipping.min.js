!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["polygon-clipping"]=e():t["polygon-clipping"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=14)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));var r=Number.EPSILON*Number.EPSILON;e.cmp=function(t,e){return-Number.EPSILON<t&&t<Number.EPSILON&&-Number.EPSILON<e&&e<Number.EPSILON?0:(t-e)*(t-e)<r*t*e?0:t<e?-1:1},e.cmpPoints=function(t,e){var n=t.x,i=e.x;if(n<=-Number.EPSILON||Number.EPSILON<=n||i<=-Number.EPSILON||Number.EPSILON<=i){var o=n-i;if(o*o>=r*n*i)return n<i?-1:1}if(n=t.y,i=e.y,n<=-Number.EPSILON||Number.EPSILON<=n||i<=-Number.EPSILON||Number.EPSILON<=i){var s=n-i;if(s*s>=r*n*i)return n<i?-1:1}return 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cosineOfAngle=e.sineOfAngle=e.compareVectorAngles=e.dotProduct=e.crossProduct=void 0;var r=n(0),i=e.crossProduct=function(t,e){return t.x*e.y-t.y*e.x},o=e.dotProduct=function(t,e){return t.x*e.x+t.y*e.y},s=(e.compareVectorAngles=function(t,e,n){var o={x:e.x-t.x,y:e.y-t.y},s={x:n.x-t.x,y:n.y-t.y},l=i(o,s);return(0,r.cmp)(l,0)},function(t){return Math.sqrt(o(t,t))});e.sineOfAngle=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},o={x:n.x-t.x,y:n.y-t.y};return i(o,r)/s(o)/s(r)},e.cosineOfAngle=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return o(i,r)/s(i)/s(r)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var i=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.types={INTERSECTION:0,UNION:1,XOR:2,DIFFERENCE:3}}return r(t,[{key:"register",value:function(t,e){this.type=t,this.numMultiPolys=e}}]),t}());e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(0),o=n(1);var s=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.point=e,this.segment=n,this.linkedEvents=[this]}return r(t,null,[{key:"compareBefore",value:function(t,e){var n=(0,i.cmp)(t.point.x,e.point.x);if(0!==n)return n<0;var r=(0,i.cmp)(t.point.y,e.point.y);if(0!==r)return r<0;if(t.isLeft!==e.isLeft)return!t.isLeft;var o=t.segment.comparePoint(e.otherSE.point);if(0!==o)return o>0;var s=t.segment.ringIn.id,l=e.segment.ringIn.id;if(s!==l)return s<l;if(t===e)return!1;throw new Error("SweepEvent comparison failed at ["+t.point.x+", "+t.point.y+"]... equal but not identical?")}}]),r(t,[{key:"link",value:function(t){for(var e=t.linkedEvents,n=0,r=e.length;n<r;n++){var i=e[n];this.linkedEvents.push(i),i.linkedEvents=this.linkedEvents}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.linkedEvents.length;e<n;e++){var r=this.linkedEvents[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i=r.otherSE;n.set(r,{sine:(0,o.sineOfAngle)(e.point,t.point,i.point),cosine:(0,o.cosineOfAngle)(e.point,t.point,i.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var o=n.get(t),s=o.sine,l=o.cosine,u=n.get(e),h=u.sine,f=u.cosine,c=(0,i.cmp)(s,0),a=(0,i.cmp)(h,0);return c>=0&&a>=0?(0,i.cmp)(f,l):c<0&&a<0?(0,i.cmp)(l,f):(0,i.cmp)(h,s)}}},{key:"isLeft",get:function(){return this===this.segment.leftSE}},{key:"isRight",get:function(){return this===this.segment.rightSE}},{key:"otherSE",get:function(){return this.segment.getOtherSE(this)}}]),t}();e.default=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=h(n(2)),o=h(n(3)),s=n(8),l=n(0),u=n(1);function h(t){return t&&t.__esModule?t:{default:t}}var f=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.ringIn=r,this.ringOut=null;var i=(0,l.cmpPoints)(e,n),s=void 0,u=void 0;if(i<0)s=e,u=n,this.flowL2R=!0;else{if(!(i>0))throw new Error("Tried to create degenerate segment at ["+e.x+", "+e.y+"]");s=n,u=e,this.flowL2R=!1}this.leftSE=new o.default(s,this),this.rightSE=new o.default(u,this),this._clearCache()}return r(t,null,[{key:"compare",value:function(t,e){if(t===e)return 0;var n=t.leftSE.point.x,r=t.leftSE.point.y,i=e.leftSE.point.x,o=e.leftSE.point.y,s=t.rightSE.point.x,u=e.rightSE.point.x;if((0,l.cmp)(u,n)<0)return 1;if((0,l.cmp)(s,i)<0)return-1;var h=t.comparePoint(e.leftSE.point),f=(0,l.cmp)(n,i);if(0!==h||0!==t.comparePoint(e.rightSE.point)||0!==e.comparePoint(t.leftSE.point)||0!==e.comparePoint(t.rightSE.point))return f<0?1===h?-1:1:f>0?1===e.comparePoint(t.leftSE.point)?1:-1:0===f&&0===(0,l.cmp)(t.leftSE.point.y,e.leftSE.point.y)?t.comparePoint(e.rightSE.point)>0?-1:1:(0,l.cmp)(r,o);if(0!==f)return f;if(t.ringIn.id!==e.ringIn.id)return t.ringIn.id<e.ringIn.id?-1:1;throw new Error("Segment comparison (from ["+t.leftSE.point.x+", "+t.leftSR.point.y+"]) -> to ["+t.rightSE.point.x+", "+t.rightSE.point.y+"]) failed...  segments equal but not identical?")}}]),r(t,[{key:"clone",value:function(){var e=new t(this.leftSE.point,this.rightSE.point,this.ringIn);return e.flowL2R=this.flowL2R,e}},{key:"getOtherSE",value:function(t){if(t===this.leftSE)return this.rightSE;if(t===this.rightSE)return this.leftSE;throw new Error("may only be called by own sweep events")}},{key:"isAnEndpoint",value:function(t){return 0===(0,l.cmpPoints)(t,this.leftSE.point)||0===(0,l.cmpPoints)(t,this.rightSE.point)}},{key:"isPointOn",value:function(t){return(0,s.isInBbox)(this.bbox,t)&&0===this.comparePoint(t)}},{key:"comparePoint",value:function(t){return this.isAnEndpoint(t)?0:(0,u.compareVectorAngles)(t,this.leftSE.point,this.rightSE.point)}},{key:"getIntersections",value:function(t){var e=(0,s.getBboxOverlap)(this.bbox,t.bbox);if(null===e)return[];for(var n=[],r=(0,s.getUniqueCorners)(e),i=0,o=r.length;i<o;i++){var h=r[i];(this.isAnEndpoint(h)&&t.isPointOn(h)||t.isAnEndpoint(h)&&this.isPointOn(h))&&n.push(h)}if(n.length>0)return n;var f=this.leftSE.point,c=t.leftSE.point,a=this.vector,g=t.vector,p={x:c.x-f.x,y:c.y-f.y},y=(0,u.crossProduct)(a,g),v=(0,u.crossProduct)(p,g)/y;if((0,l.cmp)(v,0)<0||(0,l.cmp)(1,v)<0)return[];var d=(0,u.crossProduct)(p,a)/y;if((0,l.cmp)(d,0)<0||(0,l.cmp)(1,d)<0)return[];var E=(f.x+v*a.x+c.x+d*g.x)/2,_=(f.y+v*a.y+c.y+d*g.y)/2;return E<e.ll.x&&(E=e.ll.x),E>e.ur.x&&(E=e.ur.x),_<e.ll.y&&(_=e.ll.y),_>e.ur.y&&(_=e.ur.y),[{x:E,y:_}]}},{key:"split",value:function(t){t.sort(l.cmpPoints),t=t.filter(function(t,e,n){return 0===e||0!==(0,l.cmpPoints)(n[e-1],t)});for(var e=0,n=t.length;e<n;e++){var r=t[e];if(this.isAnEndpoint(r))throw new Error("Cannot split segment upon endpoint at ["+r.x+", "+r.y+"]")}var i=t.shift(),s=this.clone();s.leftSE=new o.default(i,s),s.rightSE=this.rightSE,this.rightSE.segment=s,this.rightSE=new o.default(i,this);var u=[this.rightSE,s.leftSE];if(t.length>0)for(var h=s.split(t),f=0,c=h.length;f<c;f++)u.push(h[f]);return u}},{key:"registerPrev",value:function(t){this.prev=t,this._clearCache()}},{key:"registerRingOut",value:function(t){this.ringOut=t}},{key:"_prevInResult",value:function(){for(var t=this.prev;t&&!t.isInResult;)t=t.prev;return t}},{key:"_coincidents",value:function(){for(var t=[],e=this.leftSE.linkedEvents,n=this.rightSE.linkedEvents,r=0,i=e.length;r<i;r++){var o=e[r];o.isLeft&&(o.segment.rightSE.linkedEvents===n&&t.push(o.segment))}if(t.length>0){t.sort(function(t,e){return t.ringIn.id-e.ringIn.id});for(var s=0,l=t.length;s<l;s++)t[s]._cache.coincidents=t}return t}},{key:"_prevNotCoincident",value:function(){for(var t=this,e=this.prev;e&&t.coincidents===e.coincidents;)t=e,e=e.prev;return e}},{key:"_sweepLineEntersRing",value:function(){for(var t=this.prevNotCoincident;t;){for(var e=0,n=t.coincidents.length;e<n;e++){var r=t.coincidents[e];if(r.ringIn===this.ringIn)return!r.sweepLineEntersRing}t=t.prevNotCoincident}return!0}},{key:"_ringsInsideOf",value:function(){if(!this.prev)return[];if(this.coincidents===this.prev.coincidents)return this.prev.ringsInsideOf;for(var t=[],e=this.prev.ringsInsideOf,n=this.prev.getRingsEntering(),r=this.getRingsExiting(),i=0,o=e.length;i<o;i++){var s=e[i];r.includes(s)||t.push(s)}for(var l=0,u=n.length;l<u;l++){var h=n[l];r.includes(h)||t.push(h)}return t}},{key:"getRingsOnEdgeOf",value:function(){for(var t=[],e=0,n=this.coincidents.length;e<n;e++)t.push(this.coincidents[e].ringIn);return t}},{key:"getRingsEntering",value:function(){for(var t=[],e=0,n=this.coincidents.length;e<n;e++){var r=this.coincidents[e];r.sweepLineEntersRing&&t.push(r.ringIn)}return t}},{key:"getRingsExiting",value:function(){for(var t=[],e=0,n=this.coincidents.length;e<n;e++){var r=this.coincidents[e];r.sweepLineEntersRing||t.push(r.ringIn)}return t}},{key:"_isValidEdgeForPoly",value:function(){var t=void 0,e=void 0;return this.sweepLineEntersRing?(t=this.getRingsEntering(),e=this.getRingsExiting()):(e=this.getRingsEntering(),t=this.getRingsExiting()),this.ringIn.isValid(t,e,this.ringsInsideOf)}},{key:"getMultiPolysInsideOf",value:function(){for(var t=[],e=0,n=this.ringsInsideOf.length;e<n;e++){var r=this.ringsInsideOf[e].poly;t.includes(r.multiPoly)||r.isInside(this.getRingsOnEdgeOf(),this.ringsInsideOf)&&t.push(r.multiPoly)}return t}},{key:"getMultiPolysSLPEnters",value:function(t){for(var e=t.slice(),n=0,r=this.coincidents.length;n<r;n++){var i=this.coincidents[n];if(i.sweepLineEntersPoly){var o=i.ringIn.poly.multiPoly;e.includes(o)||e.push(o)}}return e}},{key:"getMultiPolysSLPExits",value:function(t){for(var e=t.slice(),n=0,r=this.coincidents.length;n<r;n++){var i=this.coincidents[n];if(i.sweepLineExitsPoly){var o=i.ringIn.poly.multiPoly;e.includes(o)||e.push(o)}}return e}},{key:"_isInResult",value:function(){if(this!==this.coincidents[0])return!1;var t=this.getMultiPolysInsideOf(),e=this.getMultiPolysSLPEnters(t),n=this.getMultiPolysSLPExits(t);switch(i.default.type){case i.default.types.UNION:return 0===e.length!==(0===n.length);case i.default.types.INTERSECTION:var r=void 0,o=void 0;return e.length<n.length?(r=e.length,o=n.length):(r=n.length,o=e.length),o===i.default.numMultiPolys&&r<o;case i.default.types.XOR:return Math.abs(e.length-n.length)%2==1;case i.default.types.DIFFERENCE:var s=function(t){return 1===t.length&&t[0].isSubject};return s(e)!==s(n);default:throw new Error("Unrecognized operation type found "+i.default.type)}}},{key:"_clearCache",value:function(){this._cache={}}},{key:"bbox",get:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",get:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isVertical",get:function(){return 0===(0,l.cmp)(this.leftSE.point.x,this.rightSE.point.x)}},{key:"flowIntoSE",get:function(){return this.flowL2R?this.rightSE:this.leftSE}},{key:"prevInResult",get:function(){var t="prevInResult";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"coincidents",get:function(){var t="coincidents";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"prevNotCoincident",get:function(){var t="prevNotCoincident";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"sweepLineEntersRing",get:function(){var t="sweepLineEntersRing";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"sweepLineEntersPoly",get:function(){return!!this.isValidEdgeForPoly&&this.ringIn.isExterior===this.sweepLineEntersRing}},{key:"sweepLineExitsPoly",get:function(){return!!this.isValidEdgeForPoly&&this.ringIn.isExterior!==this.sweepLineEntersRing}},{key:"ringsInsideOf",get:function(){var t="ringsInsideOf";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"isValidEdgeForPoly",get:function(){var t="isValidEdgeForPoly";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}},{key:"isInResult",get:function(){var t="isInResult";return void 0===this._cache[t]&&(this._cache[t]=this["_"+t]()),this._cache[t]}}]),t}();e.default=f},function(t,e,n){"use strict";n.r(e),n.d(e,"default",function(){return u});class r{constructor(t,e){this.key=t,this.data=e,this.left=null,this.right=null}}function i(t,e,n){if(null===e)return e;let i,o,s;const l=new r;for(i=o=l;;){const r=n(t,e.key);if(r<0){if(null===e.left)break;if(n(t,e.left.key)<0&&(s=e.left,e.left=s.right,s.right=e,null===(e=s).left))break;o.left=e,o=e,e=e.left}else{if(!(r>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(s=e.right,e.right=s.left,s.left=e,null===(e=s).right))break;i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=l.right,e.right=l.left,e}function o(t,e,n,o,s){const l=new r(t,e);if(s._size++,null===n)return l.left=l.right=null,l;const u=o(t,(n=i(t,n,o)).key);return u<0?(l.left=n.left,l.right=n,n.left=null):u>=0&&(l.right=n.right,l.left=n,n.right=null),l}function s(t,e,n,r){let o;return null===e?null:t===(e=i(t,e,n)).key?(null===e.left?o=e.right:(o=i(t,e.left,n)).right=e.right,r._size--,o):e}function l(t,e,n){let r,o;if(null===e)r=o=null;else{const s=n((e=i(t,e,n)).key,t);0===s?(r=e.left,o=e.right):s<0?(o=e.right,e.right=null,r=e):(r=e.left,e.left=null,o=e)}return{left:r,right:o}}class u{constructor(t=function(t,e){return t>e?1:t<e?-1:0}){this._comparator=t,this._root=null,this._size=0}insert(t,e){return this._root=o(t,e,this._root,this._comparator,this)}add(t,e){return this._root=function(t,e,n,o,s){const l=new r(t,e);if(null===n)return l.left=l.right=null,s._size++,l;const u=o(t,(n=i(t,n,o)).key);return 0===u?n:(u<0?(l.left=n.left,l.right=n,n.left=null):u>0&&(l.right=n.right,l.left=n,n.right=null),s._size++,l)}(t,e,this._root,this._comparator,this)}remove(t){this._root=s(t,this._root,this._comparator,this)}pop(){let t=this._root;if(t){for(;t.left;)t=t.left;return this._root=i(t.key,this._root,this._comparator),this._root=s(t.key,this._root,this._comparator,this),{key:t.key,data:t.data}}return null}findStatic(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}find(t){return this._root&&(this._root=i(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}contains(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}forEach(t,e){let n=this._root;const r=[];let i=!1;for(;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}range(t,e,n,r){const i=[],o=this._comparator;let s,l=this._root;for(;0!==i.length||l;)if(l)i.push(l),l=l.left;else{if((s=o((l=i.pop()).key,e))>0)break;if(o(l.key,t)>=0&&n.call(r,l))return this;l=l.right}return this}keys(){const t=[];return this.forEach(({key:e})=>t.push(e)),t}values(){const t=[];return this.forEach(({data:e})=>t.push(e)),t}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}at(t){let e=this._root,n=!1,r=0;const i=[];for(;!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}next(t){let e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}prev(t){let e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}clear(){return this._root=null,this._size=0,this}toList(){return function(t){var e=t,n=[],r=!1;const i={next:null};let o=i;for(;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)}load(t=[],e=[],n=!1){let r=t.length;const i=this._comparator;if(n&&function t(e,n,r,i,o){if(r>=i)return;const s=e[r+i>>1];let l=r-1;let u=i+1;for(;;){do{l++}while(o(e[l],s)<0);do{u--}while(o(e[u],s)>0);if(l>=u)break;let t=e[l];e[l]=e[u],e[u]=t,t=n[l],n[l]=n[u],n[u]=t}t(e,n,r,u,o);t(e,n,u+1,i,o)}(t,e,0,r-1,i),null===this._root)this._root=function t(e,n,r,i,o){const s=o-i;if(s>0){const l=i+Math.floor(s/2),u=n[l],h=r[l],f={key:u,data:h,parent:e};return f.left=t(f,n,r,i,l),f.right=t(f,n,r,l+1,o),f}return null}(this._root,t,e,0,r),this._size=r;else{const n=function(t,e,n=((t,e)=>t-e)){const r={};let i=r,o=t,s=e;for(;null!==o&&null!==s;)n(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;null!==o?i.next=o:null!==s&&(i.next=s);return r.next}(this.toList(),function(t,e){const n={next:null};let r=n;for(let n=0;n<t.length;n++)r=r.next={key:t[n],data:e[n]};return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=function t(e,n,r){const i=r-n;if(i>0){const o=n+Math.floor(i/2),s=t(e,n,o),l=e.head;return l.left=s,e.head=e.head.next,l.right=t(e,o+1,r),l}return null}({head:n},0,r)}return this}isEmpty(){return null===this._root}get size(){return this._size}toString(t=(t=>t.key)){const e=[];return function t(e,n,r,i,o){if(e){i(`${n}${r?"└── ":"├── "}${o(e)}\n`);const s=n+(r?"    ":"│   ");e.left&&t(e.left,s,!1,i,o),e.right&&t(e.right,s,!0,i,o)}}(this._root,"",!0,t=>e.push(t),t),e.join("")}update(t,e,n){const r=this._comparator;let{left:s,right:u}=l(t,this._root,r);this._size--,r(t,e)<0?u=o(e,n,u,r,this):s=o(e,n,s,r,this),this._root=function(t,e,n){return null===e?t:null===t?e:((e=i(t.key,e,n)).left=t,e)}(s,u,r)}split(t){return l(t,this._root,this._comparator)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=l(n(5)),o=n(0),s=l(n(4));function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.default.compare;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tree=new i.default(e),this.segments=[],this.prevEvent=null}return r(t,[{key:"process",value:function(t){var e=t.segment,n=[],r=t.isLeft?this.tree.insert(e):this.tree.find(e),i=this.tree.prev(r),s=i?i.key:null,l=this.tree.next(r),u=l?l.key:null;if(t.isLeft){var h=[];if(s){var f=s.getIntersections(e);if(f.length>0){for(var c=this._possibleSplit(s,f),a=0,g=c.length;a<g;a++)n.push(c[a]);for(var p=0,y=f.length;p<y;p++){var v=f[p];e.isAnEndpoint(v)||h.push(v)}}}if(u){var d=u.getIntersections(e);if(d.length>0){for(var E=this._possibleSplit(u,d),_=0,m=E.length;_<m;_++)n.push(E[_]);for(var x=0,k=d.length;x<k;x++){var S=d[x];e.isAnEndpoint(S)||h.push(S)}}}if(n.length>0||h.length>0){if(this.tree.remove(e),h.length>0)for(var b=e.split(h),P=0,w=b.length;P<w;P++)n.push(b[P]);return n.push(t),n}this.segments.push(e),e.registerPrev(s)}else{if(s&&u){var O=s.getIntersections(u);if(O.length>0){for(var I=this._possibleSplit(s,O),R=0,N=I.length;R<N;R++)n.push(I[R]);for(var L=0,M=(I=this._possibleSplit(u,O)).length;L<M;L++)n.push(I[L])}}this.tree.remove(e)}return this.prevEvent&&0===(0,o.cmpPoints)(this.prevEvent.point,t.point)&&this.prevEvent.link(t),this.prevEvent=t,n}},{key:"_possibleSplit",value:function(t,e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];t.isAnEndpoint(o)||n.push(o)}var s=void 0;return n.length>0?(this.tree.remove(t),s=t.split(n),this.tree.insert(t)):s=[],s}}]),t}();e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MultiPoly=e.Poly=e.Ring=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(1);function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.Ring=function(){function t(e){o(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.registerRingOut(this);this.poly=null,this._clearCache()}return r(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult&&!o.ringOut){for(var s=null,l=o.leftSE,u=o.rightSE,h=[l],f=l.linkedEvents,c=[];s=l,l=u,h.push(l),l.linkedEvents!==f;)for(;;){var a=l.getAvailableLinkedEvents();if(0===a.length){var g=h[0].point,p=h[h.length-1].point;throw new Error("Unable to complete output ring starting at ["+g.x+", "+g.y+"]. Last matching segment found ends at  ["+p.x+", "+p.y+"].")}if(1===a.length){u=a[0].otherSE;break}for(var y=null,v=0,d=c.length;v<d;v++)if(c[v].linkedEvents===l.linkedEvents){y=v;break}if(null===y){c.push({index:h.length,linkedEvents:l.linkedEvents});var E=l.getLeftmostComparator(s);u=a.sort(E)[0].otherSE;break}var _=c.splice(y)[0],m=h.splice(_.index);m.unshift(m[0].otherSE),n.push(new t(m.reverse()))}n.push(new t(h))}}return n}}]),r(t,[{key:"registerPoly",value:function(t){this.poly=t}},{key:"getGeom",value:function(){for(var t=[[this.events[0].point.x,this.events[0].point.y]],e=1,n=this.events.length-1;e<n;e++){var r=this.events[e-1].point,o=this.events[e].point,s=this.events[e+1].point;0!==(0,i.compareVectorAngles)(o,r,s)&&t.push([o.x,o.y])}var l=this.events[this.events.length-2].point,u=this.events[0].point,h=this.events[1].point;return 0===(0,i.compareVectorAngles)(u,l,h)&&t.shift(),0===t.length?null:(t.push(t[0]),this.isExteriorRing?t:t.reverse())}},{key:"_clearCache",value:function(){this._cache={}}},{key:"_getCached",value:function(t,e){return void 0===this._cache[t]&&(this._cache[t]=this["_"+t].bind(this)()),this._cache[t]}},{key:"_isExteriorRing",value:function(){return!this.enclosingRing||!!this.enclosingRing.enclosingRing&&this.enclosingRing.enclosingRing.isExteriorRing}},{key:"_enclosingRing",value:function(){for(var t=this.events[0].segment.prevInResult;t&&t.ringOut===this;)t=t.prevInResult;for(var e=t?t.prevInResult:null;;){if(!t)return null;if(!e)return t.ringOut;if(e.ringOut!==t.ringOut)return e.ringOut.enclosingRing!==t.ringOut?t.ringOut:t.ringOut.enclosingRing;e=(t=e.prevInResult)?t.prevInResult:null}}},{key:"enclosingRing",get:function(){return this._getCached("enclosingRing")}},{key:"isExteriorRing",get:function(){return this._getCached("isExteriorRing")}}]),t}();var s=e.Poly=function(){function t(e){o(this,t),this.exteriorRing=e,e.registerPoly(this),this.interiorRings=[]}return r(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.registerPoly(this)}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}();e.MultiPoly=function(){function t(e){o(this,t),this.rings=e,this.polys=this._composePolys(e)}return r(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];i.poly||(i.isExteriorRing?e.push(new s(i)):(i.enclosingRing.poly||e.push(new s(i.enclosingRing)),i.enclosingRing.poly.addInterior(i)))}return e}}]),t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getUniqueCorners=e.getBboxOverlap=e.doBboxesOverlap=e.isInBbox=void 0;var r=n(0),i=(e.isInBbox=function(t,e){var n=t.ll.x,i=t.ll.y,o=t.ur.x,s=t.ur.y,l=e.x,u=e.y;return(0,r.cmp)(n,l)<=0&&(0,r.cmp)(l,o)<=0&&(0,r.cmp)(i,u)<=0&&(0,r.cmp)(u,s)<=0},e.doBboxesOverlap=function(t,e){return!((0,r.cmp)(e.ur.x,t.ll.x)<0||(0,r.cmp)(t.ur.x,e.ll.x)<0||(0,r.cmp)(e.ur.y,t.ll.y)<0||(0,r.cmp)(t.ur.y,e.ll.y)<0)});e.getBboxOverlap=function(t,e){if(!i(t,e))return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},e.getUniqueCorners=function(t){var e=t.ll.x,n=t.ll.y,i=t.ur.x,o=t.ur.y,s=0===(0,r.cmp)(e,i),l=0===(0,r.cmp)(n,o);return s&&l?[{x:e,y:n}]:s?[{x:e,y:n},{x:e,y:o}]:l?[{x:e,y:n},{x:i,y:n}]:[{x:e,y:n},{x:e,y:o},{x:i,y:n},{x:i,y:o}]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MultiPoly=e.Poly=e.Ring=void 0;var r,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(4),s=(r=o)&&r.__esModule?r:{default:r};function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=0,h=e.Ring=function(){function t(e,n){l(this,t),this.id=u++,this.poly=n,this.segments=[];for(var r=1,i=e.length;r<i;r++)this.segments.push(new s.default(e[r-1],e[r],this))}return i(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}},{key:"isValid",value:function(t,e,n){var r=this.poly.exteriorRing,i=this.poly.interiorRings;if(this===r){for(var o=0,s=n.length;o<s;o++)if(i.includes(n[o]))return!1;for(var l=0,u=t.length;l<u;l++)if(i.includes(t[l]))return!1;return!0}if(!n.includes(r)&&!e.includes(r))return!1;for(var h=0,f=n.length;h<f;h++)if(i.includes(n[h]))return!1;for(var c=0,a=e.length;c<a;c++)if(i.includes(e[c]))return!1;return!0}},{key:"isExterior",get:function(){return this.poly.exteriorRing===this}},{key:"isInterior",get:function(){return this.poly.exteriorRing!==this}}]),t}(),f=e.Poly=function(){function t(e,n){l(this,t),this.exteriorRing=new h(e[0],this),this.interiorRings=[];for(var r=1,i=e.length;r<i;r++)this.interiorRings.push(new h(e[r],this));this.multiPoly=n}return i(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}},{key:"isInside",value:function(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n].poly===this)return!1;for(var i=!1,o=0,s=e.length;o<s;o++){var l=e[o];if(l.poly===this){if(l.isInterior)return!1;i=!0}}return i}}]),t}();e.MultiPoly=function(){function t(e){l(this,t),this.polys=[];for(var n=0,r=e.length;n<r;n++)this.polys.push(new f(e[n],this));this.isSubject=!1}return i(t,[{key:"markAsSubject",value:function(){this.isSubject=!0}},{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.errorOnSelfIntersectingRings=e.cleanRing=e.cleanMultiPoly=e.forceMultiPoly=e.pointsAsObjects=void 0;var r=n(0),i=n(1),o=(e.pointsAsObjects=function(t){var e=[];if(!Array.isArray(t))throw new Error("Input is not a Polygon or MultiPolygon");for(var n=0,r=t.length;n<r;n++){if(!Array.isArray(t[n]))throw new Error("Input is not a Polygon or MultiPolygon");e.push([]);for(var i=0,o=t[n].length;i<o;i++){if(!Array.isArray(t[n][i]))throw new Error("Input is not a Polygon or MultiPolygon");if(2!==t[n][i].length){e[n].push([]);for(var s=0,l=t[n][i].length;s<l;s++){if(!Array.isArray(t[n][i][s])||2!==t[n][i][s].length)throw new Error("Input is not a Polygon or MultiPolygon");e[n][i].push({x:t[n][i][s][0],y:t[n][i][s][1]})}}else e[n].push({x:t[n][i][0],y:t[n][i][1]})}}return e},e.forceMultiPoly=function(t){if(Array.isArray(t)){if(0===t.length)return;if(Array.isArray(t[0])){if(Array.isArray(t[0][0])&&"number"==typeof t[0][0][0].x&&"number"==typeof t[0][0][0].y)return;if("number"==typeof t[0][0].x&&"number"==typeof t[0][0].y)return void t.unshift(t.splice(0))}}throw new Error("Unrecognized input - not a polygon nor multipolygon")},e.cleanMultiPoly=function(t){for(var e=0;e<t.length;){var n=t[e];if(0!==n.length){var r=n[0];if(o(r),0!==r.length){for(var i=1;i<n.length;){var s=n[i];o(s),0===s.length?n.splice(i,1):i++}e++}else t.splice(e,1)}else t.splice(e,1)}},e.cleanRing=function(t){if(0!==t.length){0!==(0,r.cmpPoints)(t[0],t[t.length-1])&&t.push({x:t[0].x,y:t[0].y});for(var e=function(t,e,n){return 0===(0,r.cmpPoints)(t,e)||0===(0,r.cmpPoints)(e,n)||0===(0,i.compareVectorAngles)(e,t,n)},n=1;n<t.length-1;)e(t[n-1],t[n],t[n+1])?t.splice(n,1):n++;for(;t.length>2&&e(t[t.length-2],t[0],t[1]);)t.splice(0,1),t.splice(t.length-1,1),t.push(t[0]);for(;t.length<4&&t.length>0;)t.pop()}});e.errorOnSelfIntersectingRings=function(t){for(var e=function(e,n){var r=t[e],i=r.flowIntoSE;if(i.linkedEvents.length>2){var o=i.linkedEvents.filter(function(t){return t.segment.ringIn===r.ringIn});if(o.length>2){o.sort(i.getLeftmostComparator(i.otherSE));var s=o[1],l=o[o.length-1];if(s.segment.flowIntoSE===s||l.segment.flowIntoSE===l)throw new Error("Self-intersecting, crossing input ring found at ["+i.point.x+", "+i.point.y+"]")}}},n=0,r=t.length;n<r;n++)e(n)}},function(t,e,n){"use strict";function r(t,e){return t<e}function i(t){"function"==typeof(t=t||{})&&(t={compar:t}),t.compar?this._isBefore=function(e,n){return t.compar(e,n)<0}:t.comparBefore?this._isBefore=t.comparBefore:this._isBefore=r,this.length=0,this._freeSpace=!!t.freeSpace&&this._trimArraySize,this._list=new Array(t.size||100)}t.exports=i,i.prototype._list=null,i.prototype._compar=null,i.prototype._isBefore=null,i.prototype._freeSpace=null,i.prototype.length=0,i.prototype.insert=function(t){var e=++this.length,n=this._list;for(n[e]=t;e>1;){var r=e>>1,i=n[r];if(!this._isBefore(t,i))break;n[e]=i,e=r}n[e]=t},i.prototype.append=i.prototype.insert,i.prototype.push=i.prototype.insert,i.prototype.unshift=i.prototype.insert,i.prototype.enqueue=i.prototype.insert,i.prototype.peek=function(){return this.length>0?this._list[1]:void 0},i.prototype.size=function(){return this.length},i.prototype.remove=function(){if(!(this.length<1)){for(var t,e=this._list[1],n=this._list[this.length],r=1,i=2,o=this.length;i<o&&(t=this._list[i],this._isBefore(this._list[i+1],t)&&(t=this._list[i+1],i+=1),this._isBefore(t,n));)this._list[r]=t,r=i,i<<=1;return this._list[o]=0,this.length=--o,o&&(this._list[r]=n),this._freeSpace&&this._freeSpace(this._list,o),e}},i.prototype.shift=i.prototype.remove,i.prototype.pop=i.prototype.remove,i.prototype.dequeue=i.prototype.remove,i.prototype.gc=function(t){t||(t={});var e=t.minLength;void 0===e&&(e=0);var n=t.minFull;void 0===n&&(n=1),this._list.length>=e&&this.length<this._list.length*n&&this._list.splice(this.length+1,this._list.length)},i.prototype._trimArraySize=function(t,e){e>1e4&&t.length>4*e&&t.splice(e+1,t.length)},i.prototype._check=function(){var t,e,n=this._isBefore,r=function(t,e){return n(t,e)?-1:1},i=0;for(t=this.length;t>1;t--)e=t>>>1,r(this._list[e],this._list[t])>0&&r(this._list[t],this._list[e])<0&&(i=t);return i&&console.log("failed at",i>>>1,i),!i},i.prototype=i.prototype},function(t,e,n){t.exports=n(11)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){for(var f=[i.pointsAsObjects(e)],c=0,a=n.length;c<a;c++)f.push(i.pointsAsObjects(n[c]));for(var g=0,p=f.length;g<p;g++)i.forceMultiPoly(f[g]),i.cleanMultiPoly(f[g]);for(var y=[],v=0,d=f.length;v<d;v++)y.push(new o.MultiPoly(f[v]));y[0].markAsSubject(),l.default.register(t,y.length);for(var E=new r.default({comparBefore:u.default.compareBefore}),_=0,m=y.length;_<m;_++)for(var x=y[_].getSweepEvents(),k=0,S=x.length;k<S;k++)E.insert(x[k]);var b=new h.default;for(;E.length;)for(var P=b.process(E.remove()),w=0,O=P.length;w<O;w++)E.insert(P[w]);i.errorOnSelfIntersectingRings(b.segments);var I=s.Ring.factory(b.segments);return new s.MultiPoly(I).getGeom()};var r=c(n(12)),i=f(n(10)),o=f(n(9)),s=f(n(7)),l=c(n(2)),u=c(n(3)),h=c(n(6));function f(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function c(t){return t&&t.__esModule?t:{default:t}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.difference=e.xor=e.intersection=e.union=void 0;var r=o(n(13)),i=o(n(2));function o(t){return t&&t.__esModule?t:{default:t}}e.union=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.UNION,t,n)},e.intersection=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.INTERSECTION,t,n)},e.xor=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.XOR,t,n)},e.difference=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return(0,r.default)(i.default.types.DIFFERENCE,t,n)}}])});